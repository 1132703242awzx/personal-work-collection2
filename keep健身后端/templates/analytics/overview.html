{% extends "base.html" %}

{% block title %}数据分析 - Keep健身{% endblock %}
{% block page_title %}数据分析概览{% endblock %}

{% block page_content %}
<div class="row g-4 mb-4">
    <div class="col-md-3">
        <div class="stat-card" style="border-left-color: #4F46E5;">
            <div class="stat-card-icon text-primary">
                <i class="bi bi-calendar-check-fill"></i>
            </div>
            <div class="stat-card-label">总运动次数</div>
            <div class="stat-card-value text-primary">{{ total_workouts }}</div>
            <small class="text-muted">次</small>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="stat-card" style="border-left-color: #10B981;">
            <div class="stat-card-icon text-success">
                <i class="bi bi-fire"></i>
            </div>
            <div class="stat-card-label">总消耗</div>
            <div class="stat-card-value text-success">{{ total_calories }}</div>
            <small class="text-muted">千卡</small>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="stat-card" style="border-left-color: #F59E0B;">
            <div class="stat-card-icon text-warning">
                <i class="bi bi-clock-fill"></i>
            </div>
            <div class="stat-card-label">总时长</div>
            <div class="stat-card-value text-warning">{{ (total_duration / 60) | round(1) }}</div>
            <small class="text-muted">小时</small>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="stat-card" style="border-left-color: #06B6D4;">
            <div class="stat-card-icon text-info">
                <i class="bi bi-graph-up"></i>
            </div>
            <div class="stat-card-label">平均每次</div>
            <div class="stat-card-value text-info">{{ avg_duration }}</div>
            <small class="text-muted">分钟</small>
        </div>
    </div>
</div>

<div class="row g-4">
    <div class="col-lg-8">
        <div class="chart-container">
            <h5 class="mb-4"><i class="bi bi-bar-chart-fill"></i> 月度运动统计</h5>
            <canvas id="monthlyStatsChart" height="80"></canvas>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="chart-container">
            <h5 class="mb-4"><i class="bi bi-pie-chart-fill"></i> 运动类型占比</h5>
            <canvas id="typeDistributionChart"></canvas>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// 月度统计图表
fetch('/analytics/api/monthly-stats')
    .then(response => response.json())
    .then(data => {
        const ctx = document.getElementById('monthlyStatsChart').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: data.labels,
                datasets: [{
                    label: '运动次数',
                    data: data.count,
                    backgroundColor: '#4F46E5',
                    borderRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    });

// 类型分布图表
fetch('/analytics/api/workout-type-distribution')
    .then(response => response.json())
    .then(data => {
        const ctx = document.getElementById('typeDistributionChart').getContext('2d');
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: data.labels,
                datasets: [{
                    data: data.data,
                    backgroundColor: [
                        '#4F46E5', '#10B981', '#F59E0B',
                        '#06B6D4', '#8B5CF6', '#EC4899'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });
    });
</script>
{% endblock %}
